function haveAccess(a, b)
	return bit.band(bit.brshift(a, b), 1)
end

function invertAccess(a, b)
	return bit.bxor(a, bit.blshift(1, b))
end

function readAccess()
	settings.load("/disk/settings")
	return tonumber(settings.get("access", 0))
end

function writeAccess(a)
	settings.load("/disk/settings")
	settings.set("access", a)
	settings.save("/disk/settings")
end

function createAccess()
	settings.clear()
	settings.set("pid", "aubrKp7F")
	settings.save("/disk/settings")
	fs.delete("/disk/startup")
	fs.copy("startup", "/disk/startup")
end

function mainMenu()
	term.clear()
	term.setCursorPos(1, 1)
	term.setTextColor(colors.yellow)
	print("doorOS console B0")
	print("1. Access menu")
	print("2. Eject disk")
	print("3. Create access card")

	a = tonumber(read())
	if a == 1 then 
		accessMenu()
	end

	if a == 2 then
		disk.eject("top")
	end

	if a == 3 then
		createAccess()
	end

	mainMenu()
end

function accessMenu()
	term.clear()
	term.setCursorPos(1, 1)

	if not disk.hasData("top") then
		term.setTextColor(colors.red)
		print("WARNING: Insert access card.")
		sleep(1)
		mainMenu()
	end
	
	access = {"Captain", "Bridge", "Head of Personal", "Cargo"}
	currentAccess = readAccess()

	for i=1, #access do
		if haveAccess(currentAccess, i - 1) == 1 then
			term.setTextColor(colors.green)
		else
			term.setTextColor(colors.red)
		end

	   print(string.format("%d. %s", i - 1, access[i]))
	end
	term.setTextColor(colors.yellow)
	print("1337. Main menu")

	a = tonumber(read())
	if (a == 1337) then
		mainMenu()
	end

	writeAccess(invertAccess(currentAccess, a))
	accessMenu()
end

mainMenu()